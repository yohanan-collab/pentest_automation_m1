# from options.basics_attacks import attack_port_hydra, exploit_vulnerability
# from options.basics_attacks import attack_port_sqlmap, attack_port_metasploit
# from options.gobuster import GobusterEnum
# from options.new_scan import CveAllPort
# exploit_vulnerability("linux/remote/42084.rb")
# attack_port_sqlmap('192.168.111.137')
from datetime import datetime
import os
from colorama import Fore, Style
from weasyprint import HTML
from options.new_scan import SearchExploit


SearchExploit(True)
HTML_TEMPLATE = f"""
            <!doctype html>
            <html>
            <head>
                <meta charset="UTF-8" />
                <title>Pentest report</title>
                <script src="https://cdn.tailwindcss.com"> </script>
                <style>
                body {{
                font-family: 'Open Sans', sans-serif;
                font-size: 16px;
                line-height: 1.5;
                color: #333;
                margin: 0;
                padding: 0;
                }}

                header {{
                border-bottom: 1px solid #ddd;
                }}

                h1, h2 {{
                margin: 0;
                padding: 0;
                }}

                h1 {{
                font-size: 3rem;
                text-align: center;
                padding-top: 1rem;
                padding-bottom: 1rem;
                }}

                h2 {{
                font-size: 2rem;
                margin-bottom: 1rem;
                }}

                .section {{
                margin-bottom: 2rem;
                padding: 1rem;
                border-bottom: 1px solid #ddd;
                }}

                .section:last-child {{
                border-bottom: none;
                }}

                p {{
                margin: 0;
                padding: 0;
                }}

                ul {{
                list-style: none;
                padding-left: 0;
                margin: 0;
                }}

                li {{
                margin-bottom: 0.5rem;
                }}

                a {{
                color: #007bff;
                text-decoration: none;
                }}

                a:hover {{
                text-decoration: underline;
                }}

                table {{
                width: 100%;
                border-collapse: collapse;
                }}

                th, td {{
                border: 1px solid #ddd;
                padding: 0.5rem;
                text-align: left;
                }}

                th {{
                background-color: #f2f2f2;
                font-weight: bold;
                }}
            </style>

            </head>
            <body>
                
            <header class="bg-gray-100 py-4">
            <h1 class="text-3xl text-center">Pentest report</h1>
            </header>
            <main class="container mx-auto p-4">
                <h2 class="text-2xl font-bold mb-4">Summary</h2>
                <ul>
                <li><a href="#overview">I. Overview</a></li>
                <li><a href="#dns-request">II. DNS Request</a></li>
                <li><a href="#certificate-data">III. Data about HTTP/HTTPS certificate</a></li>
                <li><a href="#subdirectories">IV. Subdirectories Found</a></li>
                <li><a href="#nmap-scan">V. NMAP scan</a></li>
                <li><a href="#nikto-scan">VI. Nikto scan</a></li>
                <li><a href="#vulnerabilities">VII. Potential vulnerabilities</a></li>
                <li><a href="#exploit-find">VIII. Exploit find</a></li>
                <li><a href="#recommendations">IX. Recommendations</a></li>
                </ul>
                
                <section class="section">
                    <h2 id="exploit-find" class="text-2xl font-bold mb-4"">VIII. Exploit find</h2>
                    <p>{SearchExploit(True)}</p>
                </section>
                
                <!-- Add other sections here -->
            </main>

            </body>
            </html>


            """
# Generate the PDF
HTML(string=HTML_TEMPLATE).write_pdf(f"report/rapport_pentest.pdf")


print(f">>> {Fore.GREEN}[+] Searchsploit done !{Style.RESET_ALL}")

PATH = str(os.getcwd() + f'/report/rapport_pentest.pdf')
print(f">>> {Fore.CYAN}PDF créé avec succès à {PATH}{Style.RESET_ALL}")
print(f">>> {Fore.GREEN}[+] Terminé à {datetime.now()}{Style.RESET_ALL}")
# path = 'unix/unix/remote/17491.rb'
# print('/'.join(path.split('/')[:-1]))
# attack_port_sqlmap()
# CveAllPort('192.99.54.66')
# attack_port_hydra('192.99.54.66','22')
# Use a more descriptive variable name
# exploit_data = """
# ---------------------------------- ---------------------------------
#  Exploit Title                    |  Path
# ---------------------------------- ---------------------------------
# Adobe Flash - Sprite Creation Use | windows/dos/39610.txt
# Joomla! Component Huge-IT Portfol | php/webapps/42597.txt
# Joomla! Component Huge-IT Portfol | php/webapps/42598.txt
# Joomla! Component Huge-IT Video G | php/webapps/42596.txt
# OpenSSH < 7.4 - agent Protocol Ar | linux/remote/40963.txt
# ---------------------------------- ---------------------------------
# Shellcodes: No Results
# """

# # Split the output into lines and filter out the header and footer
# lines = [line for line in exploit_data.splitlines() if not line.startswith('--')]

# # Print only the exploit titles and paths
# for line in lines[1:-1]:  # skip the first line (header) and last line (footer)
#     print(line)
# import requests

# url = "https://www.virustotal.com/api/v3/domains/example.com"
# headers = {
#     "x-apikey": "17a19b8c00dc3caefe2450420d4e85869200c974dbef550c3ea9ea4a6a3f26ef"
# }

# response  = requests.get(url, headers=headers)

# if response.status_code == 200: 
#     print(response.text)
# else: 
#      print(f"Error: {response.status_code} - {response.text}")