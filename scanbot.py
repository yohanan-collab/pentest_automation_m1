import sys
import colorama
import getpass
from colorama import Fore, Back, Style
from options.generate_dashboard import start_dash_app
from options.new_scan import Nmap, nouveau_scan
from options.osint import osint
from options.password_analysis import password_strength
from options.password_analysis import analyze_password_from_keepass_file
from menu import Dashboard, ExploitMenu, OsintMenu, PasswordAnalyze, TargetMenu, displayMenu
from menu import displayHeader
from options.report_pdf import report_pdf
from options.search_cve import search_cve


colorama.init()
displayHeader()
def Menu():
    while True:
        displayMenu()
        choice = input(">>> Choose an option\n>>> ")
        if choice == '1':
            TargetMenu()
            subOption = str(input(">>> Choose an option\n>>> "))
            while subOption != 'z':
                if subOption == 'a':
                    nouveau_scan()
        elif choice == '2':
            report_pdf()
        elif choice == '3':
            ExploitMenu()
            subOption = str(input(">>> Choose an option\n>>> "))
            while subOption != 'z':
                if subOption == 'a':
                    search_cve()

        elif choice == '4':
            PasswordAnalyze()
            subOption = input(Fore.BLUE + ">>> Choose an option\n>>> ")
            while subOption != 'z':
                if subOption == 'a':
                    while True:
                        password = input(Fore.BLUE + ">>> Entrer le mot de passe\n>>> ")
                        if not password:
                            break
                        result = password_strength(password)
                        print(result)
                        while True:
                            print(Fore.BLUE + ">>> Voulez-vous analyser un autre mot de passe ? (o/n)")
                            answer = input(Fore.BLUE + ">>> ").lower()
                            if answer == 'o':
                                break
                            elif answer == 'n':
                                Menu()
                            else:
                                print(Fore.RED + ">>> Réponse invalide, veuillez entrer 'o' ou 'n'.")
                elif subOption == 'b':
                    file_path = input(Fore.BLUE + '>>> Entrer le chemin du fichier Keepass :\n>>> ')
                    password = getpass.getpass(Fore.BLUE + '>>> Entrer le mot de passe du fichier Keepass :\n>>> ')

                    weak_passwords = analyze_password_from_keepass_file(file_path, password)
                    if weak_passwords:
                        Menu()
                    else:
                        print(Fore.GREEN + 'Aucun mot de passe faible détecté.')
                        Menu()
            
        elif choice == '5':
            OsintMenu()
            subOption = str(input(">>> Choose an option\n>>> "))
            while subOption != 'z':
                if subOption == 'a':
                    osint()
                    break
        elif choice == '6':
            Dashboard()
            subOption = str(input(">>> Choose an option\n>>> "))
            while subOption != 'z':
                if subOption == 'a':
                    start_dash_app()
                    continue
        elif choice == '99':
            print(Fore.RED + "Au revoir !")
            sys.exit()
        else:
            print(Fore.RED + "Choix invalide, veuillez essayer encore.")
Menu()
