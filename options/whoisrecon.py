from datetime import datetime
from tabulate import tabulate
import whois as w

# def whois_query(domain):
#     displayInfos = f"\n\n===================================\n"
#     displayInfos+= f"Whois lookup for "+ domain
#     displayInfos+= f"\n===================================\n"
#     try:
#         data = w.whois(domain)
#         displayInfos+= str(data)
#         return displayInfos
#     except Exception as e:
#         error =  "Error: " + str(e)
#         displayInfos += error
#         return displayInfos

def format_value(value):
    if isinstance(value, list):
        # Check if all elements in the list are datetime.datetime objects
        if all(isinstance(item, datetime) for item in value):
            return ', '.join(item.strftime('%Y-%m-%d %H:%M:%S') for item in value)
        else:
            return ', '.join(str(item) for item in value)
    elif isinstance(value, datetime):
        return value.strftime('%Y-%m-%d %H:%M:%S')
    else:
        return str(value)

def whois_query(domain):
    displayInfos = f"\n\n===================================\n"
    displayInfos += f"Whois lookup for {domain}\n"
    displayInfos += f"===================================\n"
    try:
        data = w.whois(domain)
        table_data = []
        for key, value in data.items():
            table_data.append([key, format_value(value)])
        return table_data
    except Exception as e:
        error =  "Error: " + str(e)
        return error