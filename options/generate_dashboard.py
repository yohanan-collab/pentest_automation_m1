import dash
import dash_core_components as dcc
import dash_html_components as html
import requests
import re
from colorama import Fore
from dash.dependencies import Input, Output

from options.search_cve import search_cve

def start_dash_app():
    # Initialisation de l'application Dash
    app = dash.Dash(__name__)

    # Mise en page du tableau de bord
    app.layout = html.Div(children=[
        html.H1(children='Statistiques des vulnérabilités CVE'),
        dcc.Input(id='cve-input', type='text', placeholder='Entrez l\'ID CVE'),
        html.Div(id='cve-details')
    ])

    # Définition de la logique de rappel pour mettre à jour les détails de la CVE en fonction de l'entrée de l'utilisateur
    @app.callback(
        Output('cve-details', 'children'),
        [Input('cve-input', 'value')]
    )
    def update_cve_details(cve_id):
        details = search_cve(cve_id)
        if details:
            return html.Div([
                html.H2(f"Détails de la CVE {details['ID']}"),
                html.Ul([html.Li(f"{key}: {value}") for key, value in details.items()])
            ])
        else:
            return html.Div([html.P("Aucune CVE trouvée pour cet ID.")])

    # Exécution de l'application
    app.run_server(debug=True)