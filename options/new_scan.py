import re
import nmap


def extract_version(version_string):
    # Utilisation d'une expression régulière pour extraire la version principale (par exemple, "7.6")
    version_match = re.search(r'(\d+\.\d+)', version_string)
    if version_match:
        return version_match.group(1)
    else:
        return ''

def Nmap(ip):
    nm = nmap.PortScanner()
    nm.scan(ip, '21-443')

    results = []

    for host in nm.all_hosts():
        for proto in nm[host].all_protocols():
            ports = nm[host][proto].keys()
            for port in ports:
                state = nm[host][proto][port]['state']
                if state == 'open':
                    service = nm[host][proto][port]['name']
                version = extract_version(nm[host][proto][port]['version']) if 'version' in nm[host][proto][port] else ''
                results.append([host, port, service, version])

    return results